7acdc8e33958682ef487e27cfc98717e
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../repositories/planet.repository', () => {
    // Create a simple in-memory "database"
    const planetStatus = {
        '1': false, // Tatooine - not destroyed
        '2': true // Alderaan - destroyed
    };
    return {
        PlanetRepository: jest.fn().mockImplementation(() => {
            return {
                getPlanetDestructionStatus: jest.fn().mockImplementation((id) => {
                    return Promise.resolve(planetStatus[id] !== undefined ? planetStatus[id] : null);
                }),
                upsertPlanetDestructionStatus: jest.fn().mockImplementation((id, destroyed) => {
                    planetStatus[id] = destroyed;
                    return Promise.resolve();
                })
            };
        })
    };
});
jest.mock('../adapters/swapi.adapter', () => {
    const speciesData = [
        {
            name: 'Human',
            classification: 'mammal',
            designation: 'sentient',
            average_height: '180',
            skin_colors: 'caucasian, black, asian, hispanic',
            hair_colors: 'blonde, brown, black, red',
            eye_colors: 'brown, blue, green, hazel, grey, amber',
            average_lifespan: '120',
            homeworld: 'https://swapi.dev/api/planets/1/',
            language: 'Galactic Basic',
            people: ['https://swapi.dev/api/people/1/'],
            films: ['https://swapi.dev/api/films/1/'],
            created: '2014-12-09T13:50:49.641000Z',
            edited: '2014-12-20T20:58:18.411000Z',
            url: 'https://swapi.dev/api/species/1/'
        },
        {
            name: 'Wookie',
            classification: 'mammal',
            designation: 'sentient',
            average_height: '210',
            skin_colors: 'gray',
            hair_colors: 'black, brown',
            eye_colors: 'blue, green, yellow, brown, golden, red',
            average_lifespan: '400',
            homeworld: 'https://swapi.dev/api/planets/2/',
            language: 'Shyriiwook',
            people: ['https://swapi.dev/api/people/13/'],
            films: ['https://swapi.dev/api/films/1/'],
            created: '2014-12-10T16:44:31.486000Z',
            edited: '2014-12-20T21:36:42.142000Z',
            url: 'https://swapi.dev/api/species/2/'
        }
    ];
    const planetData = {
        '1': {
            name: 'Tatooine',
            rotation_period: '23',
            orbital_period: '304',
            diameter: '10465',
            climate: 'arid',
            gravity: '1 standard',
            terrain: 'desert',
            surface_water: '1',
            population: '200000',
            residents: ['https://swapi.dev/api/people/1/'],
            films: ['https://swapi.dev/api/films/1/'],
            created: '2014-12-09T13:50:49.641000Z',
            edited: '2014-12-20T20:58:18.411000Z',
            url: 'https://swapi.dev/api/planets/1/'
        },
        '2': {
            name: 'Alderaan',
            rotation_period: '24',
            orbital_period: '364',
            diameter: '12500',
            climate: 'temperate',
            gravity: '1 standard',
            terrain: 'grasslands, mountains',
            surface_water: '40',
            population: '2000000000',
            residents: ['https://swapi.dev/api/people/5/'],
            films: ['https://swapi.dev/api/films/1/'],
            created: '2014-12-10T11:35:48.479000Z',
            edited: '2014-12-20T20:58:18.420000Z',
            url: 'https://swapi.dev/api/planets/2/'
        }
    };
    return {
        SwapiAdapter: jest.fn().mockImplementation(() => {
            return {
                getSpecies: jest.fn().mockImplementation((id) => {
                    const species = speciesData.find(s => s.url.endsWith(`/${id}/`));
                    if (!species) {
                        return Promise.reject(new Error(`Species with ID ${id} not found`));
                    }
                    return Promise.resolve(species);
                }),
                getAllSpecies: jest.fn().mockResolvedValue(speciesData),
                getPlanet: jest.fn().mockImplementation((id) => {
                    const planet = planetData[id];
                    if (!planet) {
                        return Promise.reject(new Error(`Planet with ID ${id} not found`));
                    }
                    return Promise.resolve(planet);
                })
            };
        })
    };
});
const server_1 = require("../server");
const supertest_1 = __importDefault(require("supertest"));
describe('Basic API Integration Tests - Core Functionality', () => {
    let app;
    let request;
    beforeAll(async () => {
        app = (0, server_1.build)();
        await app.ready();
        request = (0, supertest_1.default)(app.server);
    });
    afterAll(async () => {
        await app.close();
    });
    test('GET /species should return all species with their homeworlds', async () => {
        const response = await request.get('/species');
        expect(response.status).toBe(200);
        expect(response.body).toHaveProperty('species');
        expect(Array.isArray(response.body.species)).toBe(true);
        expect(response.body.species.length).toBeGreaterThan(0);
        const species = response.body.species[0];
        expect(species).toHaveProperty('name');
        expect(species).toHaveProperty('classification');
        expect(species).toHaveProperty('designation');
        expect(species).toHaveProperty('average_height');
        const speciesWithHomeworld = response.body.species.find(s => s.homeworld);
        if (speciesWithHomeworld) {
            expect(speciesWithHomeworld.homeworld).toHaveProperty('name');
            expect(speciesWithHomeworld.homeworld).toHaveProperty('climate');
            expect(speciesWithHomeworld.homeworld).toHaveProperty('terrain');
            expect(speciesWithHomeworld.homeworld).toHaveProperty('destroyed');
        }
    });
    test('GET /species?sort=average_height&order=desc should return species sorted by height', async () => {
        const response = await request.get('/species?sort=average_height&order=desc');
        expect(response.status).toBe(200);
        expect(response.body).toHaveProperty('species');
        expect(Array.isArray(response.body.species)).toBe(true);
        expect(response.body.species[0].name).toBe('Wookie');
        expect(response.body.species[1].name).toBe('Human');
    });
    test('GET /species/:id should return a specific species with its homeworld', async () => {
        const response = await request.get('/species/1');
        expect(response.status).toBe(200);
        expect(response.body).toHaveProperty('species');
        expect(response.body.species).toHaveProperty('name', 'Human');
        expect(response.body.species).toHaveProperty('classification', 'mammal');
        expect(response.body.species.homeworld).toHaveProperty('name', 'Tatooine');
        expect(response.body.species.homeworld).toHaveProperty('destroyed', false);
    });
    test('PUT /planets/:id/destruction should update a planet\'s destruction status', async () => {
        const response = await request
            .put('/planets/1/destruction')
            .send({ destroyed: true });
        expect(response.status).toBe(200);
        expect(response.body).toHaveProperty('planet');
        expect(response.body.planet).toHaveProperty('destroyed', true);
        const verifyResponse = await request.get('/species/1');
        expect(verifyResponse.body.species.homeworld.destroyed).toBe(true);
        await request
            .put('/planets/1/destruction')
            .send({ destroyed: false });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQyxZQUFZLENBQUMsQ0FBQztRQUN2RCxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVuRSxNQUFNLE9BQU87YUFDVixHQUFHLENBQUMsd0JBQXdCLENBQUM7YUFDN0IsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvdG1wL3NyYy90ZXN0cy9hcGkuaW50ZWdyYXRpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBidWlsZCB9IGZyb20gJy4uL3NlcnZlcic7XG5pbXBvcnQgeyBGYXN0aWZ5SW5zdGFuY2UgfSBmcm9tICdmYXN0aWZ5JztcbmltcG9ydCBzdXBlcnRlc3QgZnJvbSAnc3VwZXJ0ZXN0Jztcbmplc3QubW9jaygnLi4vcmVwb3NpdG9yaWVzL3BsYW5ldC5yZXBvc2l0b3J5JywgKCkgPT4ge1xuICAvLyBDcmVhdGUgYSBzaW1wbGUgaW4tbWVtb3J5IFwiZGF0YWJhc2VcIlxuICBjb25zdCBwbGFuZXRTdGF0dXMgPSB7XG4gICAgJzEnOiBmYWxzZSwgIC8vIFRhdG9vaW5lIC0gbm90IGRlc3Ryb3llZFxuICAgICcyJzogdHJ1ZSAgICAvLyBBbGRlcmFhbiAtIGRlc3Ryb3llZFxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgUGxhbmV0UmVwb3NpdG9yeTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXRQbGFuZXREZXN0cnVjdGlvblN0YXR1czogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaWQpID0+IHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHBsYW5ldFN0YXR1c1tpZF0gIT09IHVuZGVmaW5lZCA/IHBsYW5ldFN0YXR1c1tpZF0gOiBudWxsKTtcbiAgICAgICAgfSksXG4gICAgICAgIHVwc2VydFBsYW5ldERlc3RydWN0aW9uU3RhdHVzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChpZCwgZGVzdHJveWVkKSA9PiB7XG4gICAgICAgICAgcGxhbmV0U3RhdHVzW2lkXSA9IGRlc3Ryb3llZDtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIH0pXG4gICAgICB9O1xuICAgIH0pXG4gIH07XG59KTtcblxuamVzdC5tb2NrKCcuLi9hZGFwdGVycy9zd2FwaS5hZGFwdGVyJywgKCkgPT4ge1xuICBjb25zdCBzcGVjaWVzRGF0YSA9IFtcbiAgICB7XG4gICAgICBuYW1lOiAnSHVtYW4nLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdtYW1tYWwnLFxuICAgICAgZGVzaWduYXRpb246ICdzZW50aWVudCcsXG4gICAgICBhdmVyYWdlX2hlaWdodDogJzE4MCcsXG4gICAgICBza2luX2NvbG9yczogJ2NhdWNhc2lhbiwgYmxhY2ssIGFzaWFuLCBoaXNwYW5pYycsXG4gICAgICBoYWlyX2NvbG9yczogJ2Jsb25kZSwgYnJvd24sIGJsYWNrLCByZWQnLFxuICAgICAgZXllX2NvbG9yczogJ2Jyb3duLCBibHVlLCBncmVlbiwgaGF6ZWwsIGdyZXksIGFtYmVyJyxcbiAgICAgIGF2ZXJhZ2VfbGlmZXNwYW46ICcxMjAnLFxuICAgICAgaG9tZXdvcmxkOiAnaHR0cHM6Ly9zd2FwaS5kZXYvYXBpL3BsYW5ldHMvMS8nLFxuICAgICAgbGFuZ3VhZ2U6ICdHYWxhY3RpYyBCYXNpYycsXG4gICAgICBwZW9wbGU6IFsnaHR0cHM6Ly9zd2FwaS5kZXYvYXBpL3Blb3BsZS8xLyddLFxuICAgICAgZmlsbXM6IFsnaHR0cHM6Ly9zd2FwaS5kZXYvYXBpL2ZpbG1zLzEvJ10sXG4gICAgICBjcmVhdGVkOiAnMjAxNC0xMi0wOVQxMzo1MDo0OS42NDEwMDBaJyxcbiAgICAgIGVkaXRlZDogJzIwMTQtMTItMjBUMjA6NTg6MTguNDExMDAwWicsXG4gICAgICB1cmw6ICdodHRwczovL3N3YXBpLmRldi9hcGkvc3BlY2llcy8xLydcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdXb29raWUnLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdtYW1tYWwnLFxuICAgICAgZGVzaWduYXRpb246ICdzZW50aWVudCcsXG4gICAgICBhdmVyYWdlX2hlaWdodDogJzIxMCcsXG4gICAgICBza2luX2NvbG9yczogJ2dyYXknLFxuICAgICAgaGFpcl9jb2xvcnM6ICdibGFjaywgYnJvd24nLFxuICAgICAgZXllX2NvbG9yczogJ2JsdWUsIGdyZWVuLCB5ZWxsb3csIGJyb3duLCBnb2xkZW4sIHJlZCcsXG4gICAgICBhdmVyYWdlX2xpZmVzcGFuOiAnNDAwJyxcbiAgICAgIGhvbWV3b3JsZDogJ2h0dHBzOi8vc3dhcGkuZGV2L2FwaS9wbGFuZXRzLzIvJyxcbiAgICAgIGxhbmd1YWdlOiAnU2h5cmlpd29vaycsXG4gICAgICBwZW9wbGU6IFsnaHR0cHM6Ly9zd2FwaS5kZXYvYXBpL3Blb3BsZS8xMy8nXSxcbiAgICAgIGZpbG1zOiBbJ2h0dHBzOi8vc3dhcGkuZGV2L2FwaS9maWxtcy8xLyddLFxuICAgICAgY3JlYXRlZDogJzIwMTQtMTItMTBUMTY6NDQ6MzEuNDg2MDAwWicsXG4gICAgICBlZGl0ZWQ6ICcyMDE0LTEyLTIwVDIxOjM2OjQyLjE0MjAwMFonLFxuICAgICAgdXJsOiAnaHR0cHM6Ly9zd2FwaS5kZXYvYXBpL3NwZWNpZXMvMi8nXG4gICAgfVxuICBdO1xuXG4gIGNvbnN0IHBsYW5ldERhdGEgPSB7XG4gICAgJzEnOiB7XG4gICAgICBuYW1lOiAnVGF0b29pbmUnLFxuICAgICAgcm90YXRpb25fcGVyaW9kOiAnMjMnLFxuICAgICAgb3JiaXRhbF9wZXJpb2Q6ICczMDQnLFxuICAgICAgZGlhbWV0ZXI6ICcxMDQ2NScsXG4gICAgICBjbGltYXRlOiAnYXJpZCcsXG4gICAgICBncmF2aXR5OiAnMSBzdGFuZGFyZCcsXG4gICAgICB0ZXJyYWluOiAnZGVzZXJ0JyxcbiAgICAgIHN1cmZhY2Vfd2F0ZXI6ICcxJyxcbiAgICAgIHBvcHVsYXRpb246ICcyMDAwMDAnLFxuICAgICAgcmVzaWRlbnRzOiBbJ2h0dHBzOi8vc3dhcGkuZGV2L2FwaS9wZW9wbGUvMS8nXSxcbiAgICAgIGZpbG1zOiBbJ2h0dHBzOi8vc3dhcGkuZGV2L2FwaS9maWxtcy8xLyddLFxuICAgICAgY3JlYXRlZDogJzIwMTQtMTItMDlUMTM6NTA6NDkuNjQxMDAwWicsXG4gICAgICBlZGl0ZWQ6ICcyMDE0LTEyLTIwVDIwOjU4OjE4LjQxMTAwMFonLFxuICAgICAgdXJsOiAnaHR0cHM6Ly9zd2FwaS5kZXYvYXBpL3BsYW5ldHMvMS8nXG4gICAgfSxcbiAgICAnMic6IHtcbiAgICAgIG5hbWU6ICdBbGRlcmFhbicsXG4gICAgICByb3RhdGlvbl9wZXJpb2Q6ICcyNCcsXG4gICAgICBvcmJpdGFsX3BlcmlvZDogJzM2NCcsXG4gICAgICBkaWFtZXRlcjogJzEyNTAwJyxcbiAgICAgIGNsaW1hdGU6ICd0ZW1wZXJhdGUnLFxuICAgICAgZ3Jhdml0eTogJzEgc3RhbmRhcmQnLFxuICAgICAgdGVycmFpbjogJ2dyYXNzbGFuZHMsIG1vdW50YWlucycsXG4gICAgICBzdXJmYWNlX3dhdGVyOiAnNDAnLFxuICAgICAgcG9wdWxhdGlvbjogJzIwMDAwMDAwMDAnLFxuICAgICAgcmVzaWRlbnRzOiBbJ2h0dHBzOi8vc3dhcGkuZGV2L2FwaS9wZW9wbGUvNS8nXSxcbiAgICAgIGZpbG1zOiBbJ2h0dHBzOi8vc3dhcGkuZGV2L2FwaS9maWxtcy8xLyddLFxuICAgICAgY3JlYXRlZDogJzIwMTQtMTItMTBUMTE6MzU6NDguNDc5MDAwWicsXG4gICAgICBlZGl0ZWQ6ICcyMDE0LTEyLTIwVDIwOjU4OjE4LjQyMDAwMFonLFxuICAgICAgdXJsOiAnaHR0cHM6Ly9zd2FwaS5kZXYvYXBpL3BsYW5ldHMvMi8nXG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgU3dhcGlBZGFwdGVyOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGdldFNwZWNpZXM6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGlkKSA9PiB7XG4gICAgICAgICAgY29uc3Qgc3BlY2llcyA9IHNwZWNpZXNEYXRhLmZpbmQocyA9PiBzLnVybC5lbmRzV2l0aChgLyR7aWR9L2ApKTtcbiAgICAgICAgICBpZiAoIXNwZWNpZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoYFNwZWNpZXMgd2l0aCBJRCAke2lkfSBub3QgZm91bmRgKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoc3BlY2llcyk7XG4gICAgICAgIH0pLFxuICAgICAgICBnZXRBbGxTcGVjaWVzOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoc3BlY2llc0RhdGEpLFxuICAgICAgICBnZXRQbGFuZXQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGlkKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGxhbmV0ID0gcGxhbmV0RGF0YVtpZF07XG4gICAgICAgICAgaWYgKCFwbGFuZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoYFBsYW5ldCB3aXRoIElEICR7aWR9IG5vdCBmb3VuZGApKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShwbGFuZXQpO1xuICAgICAgICB9KVxuICAgICAgfTtcbiAgICB9KVxuICB9O1xufSk7XG5cbmRlc2NyaWJlKCdCYXNpYyBBUEkgSW50ZWdyYXRpb24gVGVzdHMgLSBDb3JlIEZ1bmN0aW9uYWxpdHknLCAoKSA9PiB7XG4gIGxldCBhcHA6IEZhc3RpZnlJbnN0YW5jZTtcbiAgbGV0IHJlcXVlc3Q6IGFueTtcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGFwcCA9IGJ1aWxkKCk7XG4gICAgYXdhaXQgYXBwLnJlYWR5KCk7XG4gICAgcmVxdWVzdCA9IHN1cGVydGVzdChhcHAuc2VydmVyKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGFwcC5jbG9zZSgpO1xuICB9KTtcblxuICB0ZXN0KCdHRVQgL3NwZWNpZXMgc2hvdWxkIHJldHVybiBhbGwgc3BlY2llcyB3aXRoIHRoZWlyIGhvbWV3b3JsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0LmdldCgnL3NwZWNpZXMnKTtcblxuICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3NwZWNpZXMnKTtcbiAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXNwb25zZS5ib2R5LnNwZWNpZXMpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnNwZWNpZXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG5cbiAgICBjb25zdCBzcGVjaWVzID0gcmVzcG9uc2UuYm9keS5zcGVjaWVzWzBdO1xuICAgIGV4cGVjdChzcGVjaWVzKS50b0hhdmVQcm9wZXJ0eSgnbmFtZScpO1xuICAgIGV4cGVjdChzcGVjaWVzKS50b0hhdmVQcm9wZXJ0eSgnY2xhc3NpZmljYXRpb24nKTtcbiAgICBleHBlY3Qoc3BlY2llcykudG9IYXZlUHJvcGVydHkoJ2Rlc2lnbmF0aW9uJyk7XG4gICAgZXhwZWN0KHNwZWNpZXMpLnRvSGF2ZVByb3BlcnR5KCdhdmVyYWdlX2hlaWdodCcpO1xuXG4gICAgY29uc3Qgc3BlY2llc1dpdGhIb21ld29ybGQgPSByZXNwb25zZS5ib2R5LnNwZWNpZXMuZmluZChzID0+IHMuaG9tZXdvcmxkKTtcbiAgICBpZiAoc3BlY2llc1dpdGhIb21ld29ybGQpIHtcbiAgICAgIGV4cGVjdChzcGVjaWVzV2l0aEhvbWV3b3JsZC5ob21ld29ybGQpLnRvSGF2ZVByb3BlcnR5KCduYW1lJyk7XG4gICAgICBleHBlY3Qoc3BlY2llc1dpdGhIb21ld29ybGQuaG9tZXdvcmxkKS50b0hhdmVQcm9wZXJ0eSgnY2xpbWF0ZScpO1xuICAgICAgZXhwZWN0KHNwZWNpZXNXaXRoSG9tZXdvcmxkLmhvbWV3b3JsZCkudG9IYXZlUHJvcGVydHkoJ3RlcnJhaW4nKTtcbiAgICAgIGV4cGVjdChzcGVjaWVzV2l0aEhvbWV3b3JsZC5ob21ld29ybGQpLnRvSGF2ZVByb3BlcnR5KCdkZXN0cm95ZWQnKTtcbiAgICB9XG4gIH0pO1xuXG4gIHRlc3QoJ0dFVCAvc3BlY2llcz9zb3J0PWF2ZXJhZ2VfaGVpZ2h0Jm9yZGVyPWRlc2Mgc2hvdWxkIHJldHVybiBzcGVjaWVzIHNvcnRlZCBieSBoZWlnaHQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0LmdldCgnL3NwZWNpZXM/c29ydD1hdmVyYWdlX2hlaWdodCZvcmRlcj1kZXNjJyk7XG5cbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdzcGVjaWVzJyk7XG4gICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS5zcGVjaWVzKSkudG9CZSh0cnVlKTtcblxuICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnNwZWNpZXNbMF0ubmFtZSkudG9CZSgnV29va2llJyk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3BlY2llc1sxXS5uYW1lKS50b0JlKCdIdW1hbicpO1xuICB9KTtcblxuICB0ZXN0KCdHRVQgL3NwZWNpZXMvOmlkIHNob3VsZCByZXR1cm4gYSBzcGVjaWZpYyBzcGVjaWVzIHdpdGggaXRzIGhvbWV3b3JsZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QuZ2V0KCcvc3BlY2llcy8xJyk7XG5cbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdzcGVjaWVzJyk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3BlY2llcykudG9IYXZlUHJvcGVydHkoJ25hbWUnLCAnSHVtYW4nKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zcGVjaWVzKS50b0hhdmVQcm9wZXJ0eSgnY2xhc3NpZmljYXRpb24nLCAnbWFtbWFsJyk7XG5cbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zcGVjaWVzLmhvbWV3b3JsZCkudG9IYXZlUHJvcGVydHkoJ25hbWUnLCAnVGF0b29pbmUnKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zcGVjaWVzLmhvbWV3b3JsZCkudG9IYXZlUHJvcGVydHkoJ2Rlc3Ryb3llZCcsIGZhbHNlKTtcbiAgfSk7XG5cbiAgdGVzdCgnUFVUIC9wbGFuZXRzLzppZC9kZXN0cnVjdGlvbiBzaG91bGQgdXBkYXRlIGEgcGxhbmV0XFwncyBkZXN0cnVjdGlvbiBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0XG4gICAgICAucHV0KCcvcGxhbmV0cy8xL2Rlc3RydWN0aW9uJylcbiAgICAgIC5zZW5kKHsgZGVzdHJveWVkOiB0cnVlIH0pO1xuXG4gICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgncGxhbmV0Jyk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkucGxhbmV0KS50b0hhdmVQcm9wZXJ0eSgnZGVzdHJveWVkJywgdHJ1ZSk7XG5cbiAgICBjb25zdCB2ZXJpZnlSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QuZ2V0KCcvc3BlY2llcy8xJyk7XG4gICAgZXhwZWN0KHZlcmlmeVJlc3BvbnNlLmJvZHkuc3BlY2llcy5ob21ld29ybGQuZGVzdHJveWVkKS50b0JlKHRydWUpO1xuXG4gICAgYXdhaXQgcmVxdWVzdFxuICAgICAgLnB1dCgnL3BsYW5ldHMvMS9kZXN0cnVjdGlvbicpXG4gICAgICAuc2VuZCh7IGRlc3Ryb3llZDogZmFsc2UgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9